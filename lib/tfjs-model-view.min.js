!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("tfjs-model-view",[],t):"object"==typeof exports?exports["tfjs-model-view"]=t():e["tfjs-model-view"]=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(1)),a=i(r(2)),o=i(r(4));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=Object.assign({},o.default,r),u=void 0;i.predictCallback=function(e){u&&u.update(t,e)},i.hookCallback=function(e){u&&u.render(e)},(0,n.default)(t,i).then((function(e){u=new a.default(i,e)}))},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=(n=i(regeneratorRuntime.mark((function e(t,r){var n,o,s,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function e(t,r){var a,s=this,c=t.name,l=t.input,f=t.inputs,d=t.shape,p=t.sourceLayer,h=p||{},y=h.getWeights,v=h.setCallHook,g=h.activation,b={previousColumn:[],name:c,shape:d,weights:{},getWeights:u,mapPosition:Object.keys(n.layerMap).length};if(n.layerMap[c]=b,n.layerArr.unshift(b),g){var m=g.getClassName();b.activation={name:m}}return v&&p.setCallHook((a=i(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.getWeights(),b.activations=[],r=0;case 3:if(!(r<t.length)){e.next=12;break}return e.t0=b.activations,e.next=7,t[r].dataSync();case 7:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 9:r++,e.next=3;break;case 12:o.hookCallback(b);case 13:case"end":return e.stop()}}),e,s)}))),function(e){return a.apply(this,arguments)})),y&&(b.getWeights=i(regeneratorRuntime.mark((function e(){var t,r,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.getWeights();case 2:t=e.sent,r=0;case 4:if(!(r<t.length)){e.next=16;break}return n=t[r],a=n.rankType,o=n.name,b.hasWeights=!0,e.t0=o,e.next=11,t[r].dataSync();case 11:e.t1=e.sent,b.weights[a]={name:e.t0,values:e.t1};case 13:r++,e.next=4;break;case 16:case"end":return e.stop()}}),e,s)}))),b.getWeights()),f?f.forEach((function(t){e(t,b.previousColumn)})):e(l,b.previousColumn),r&&r.push(b),b},n={layerMap:{},layerArr:[]},o=a({predictCallback:u,hookCallback:u},r),c=t.predict,t.predict=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var a=c.apply(t,r);return t.outputData=a.dataSync(),o.predictCallback(r),a},e.next=7,s(t.layers[t.layers.length-1].output);case 7:return n.model=e.sent,r.printStats&&(l=n.layerArr,console.log(new Array(10).join("-")),l.forEach((function(e){console.log("Layer: "+e.name)}))),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)});function i(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(a,o){try{var i=t[a](o),u=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(u).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(u)}("next")}))}}function u(){}t.default=o,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(3);var i=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),a=document.createElement("canvas");return a.setAttribute("width",n.width),a.setAttribute("height",n.height),document.body.appendChild(a),n.renderContext=a.getContext("2d"),n.renderElement=a,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"update",value:function(e,t){var r=this,n=Object.keys(this.layers).filter((function(e){return-1!==e.indexOf("_input")}));if(n.length!==t.length)throw new Error("identified 2 input layers: "+n.join(",")+" and had only "+t.length+" input values");n.forEach((function(e,n){r.render({name:e},t[n].dataSync())})),this.render(this.outputLayer,e.outputData)}},{key:"render",value:function(e,t,r){var n=this,a=e.name,o=e.previousColumn;if(t||r){var i=t||r,u=this.height;try{var s=this.layers[a],c=s.x,l=s.layerWidth,f=s.radius,d=s.nodes,p=s.layerHeight,h=s.domainMax,y=Math.floor((u-p)/2);this.renderContext.clearRect(c-f/2-2,0,l+2,u),d.forEach((function(e,t){var r=e.x,a=e.y;n.renderContext.strokeStyle="#000",n.renderContext.fillStyle="rgba(0,0,0, "+i[t]/h+")",n.renderContext.beginPath(),n.renderContext.arc(r,y+a,f/2,0,2*Math.PI),f>3&&n.renderContext.stroke(),n.renderContext.fill()}))}catch(e){}}else if(o&&o.length>0&&e.activations)for(var v=0;v<e.previousColumn.length;v++)this.render(e.previousColumn[v],e.activations[v])}}]),t}(((n=o)&&n.__esModule?n:{default:n}).default);t.default=i,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};t.default=function e(t,r){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=t.xPadding,i=t.yPadding,u=t.layer,s=void 0===u?{}:u,c=r.layerArr,l=2*(i||1),f=o||0;this.layers={},c.forEach((function(e){var r=e.name,o=e.shape;e.activation;a.outputLayer=e;var i=s[r]||{},u=Object.assign({},t,i),c=u.radius,d=u.nodePadding,p=u.layerPadding,h=u.groupPadding,y=u.domainMax,v=void 0===y?1:y,g=u.reshape,b=Object.assign([1,1,1],o.slice(1)),m=n(b,3),x=m[0],w=m[1],j=m[2],O=x*w*j;if(g){var P=Object.assign([1,1,1],g),_=n(P,3),C=_[0],k=_[1],M=_[2];if(C*k*M!==O)throw new Error("Unable to reshape from ["+x+", "+w+", "+j+"] to ["+C+", "+k+", "+M+"]");x=C,w=k,j=M}f+=p;for(var E=c+d,S=p+w*E,A=[],W=0,R=0;R<x;R++)for(var T=0;T<w;T++)for(var H=0;H<j;H++){var L=h+c+R*E+H*x*(E+h);A.push({x:f+T*E,y:L}),W=L}W+=h+c,l=Math.max(l,W),a.layers[r]={name:r,x:f,layerWidth:S,layerHeight:W,radius:c,nodes:A,domainMax:v,layer:e},f+=S})),f+=o||0,Object.assign(this,{width:f,height:l})},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={renderer:"canvas",radius:6,nodePadding:2,layerPadding:20,groupPadding:1,xPadding:10,yPadding:10,plotActivations:!1},e.exports=t.default}])}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90ZmpzLW1vZGVsLXZpZXcvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL3RmanMtbW9kZWwtdmlldy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly90ZmpzLW1vZGVsLXZpZXcvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vdGZqcy1tb2RlbC12aWV3Ly4vc3JjL21vZGVsLXBhcnNlci5qcyIsIndlYnBhY2s6Ly90ZmpzLW1vZGVsLXZpZXcvLi9zcmMvcmVuZGVyZXJzL2NhbnZhcy5yZW5kZXJlci5qcyIsIndlYnBhY2s6Ly90ZmpzLW1vZGVsLXZpZXcvLi9zcmMvcmVuZGVyZXJzL2Fic3RyYWN0LnJlbmRlcmVyLmpzIiwid2VicGFjazovL3RmanMtbW9kZWwtdmlldy8uL3NyYy9kZWZhdWx0LmNvbmZpZy5qcyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJzZWxmIiwidGhpcyIsImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJtb2RlbCIsImN1c3RvbUNvbmZpZyIsImNvbmZpZyIsImFzc2lnbiIsImRlZmF1bHRDb25maWciLCJyZW5kZXJlciIsInByZWRpY3RDYWxsYmFjayIsImlucHV0IiwidXBkYXRlIiwiaG9va0NhbGxiYWNrIiwibGF5ZXIiLCJyZW5kZXIiLCJ0aGVuIiwicmVzIiwiQ2FudmFzUmVuZGVyZXIiLCJvcHRpb25zIiwicGFyc2VMYXllciIsIm5leHRDb2x1bW4iLCJpbnB1dHMiLCJzaGFwZSIsInNvdXJjZUxheWVyIiwiZ2V0V2VpZ2h0cyIsInNldENhbGxIb29rIiwiYWN0aXZhdGlvbiIsImN1cnJlbnRMYXllciIsInByZXZpb3VzQ29sdW1uIiwid2VpZ2h0cyIsIm5vb3AiLCJtYXBQb3NpdGlvbiIsImtleXMiLCJwYXJzZWQiLCJsYXllck1hcCIsImxlbmd0aCIsImxheWVyQXJyIiwidW5zaGlmdCIsImNsYXNzTmFtZSIsImdldENsYXNzTmFtZSIsImxheWVySW5wdXQiLCJhY3RpdmF0aW9ucyIsImRhdGFTeW5jIiwicHVzaCIsInBhcnNlckNvbmZpZyIsIndlaWdodCIsInJhbmtUeXBlIiwid2VpZ2h0TmFtZSIsImhhc1dlaWdodHMiLCJ2YWx1ZXMiLCJmb3JFYWNoIiwiaW5wIiwicHJlZGljdCIsImFyZ3MiLCJyZXN1bHQiLCJhcHBseSIsIm91dHB1dERhdGEiLCJsYXllcnMiLCJvdXRwdXQiLCJwcmludFN0YXRzIiwiY29uc29sZSIsImxvZyIsIkFycmF5Iiwiam9pbiIsInBhcnNlTW9kZWwiLCJpbml0RGF0YSIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsIndpZHRoIiwiaGVpZ2h0IiwiYm9keSIsImFwcGVuZENoaWxkIiwicmVuZGVyQ29udGV4dCIsImdldENvbnRleHQiLCJyZW5kZXJFbGVtZW50IiwiZmlsdGVyIiwiaW5kZXhPZiIsIkVycm9yIiwiaW5kZXgiLCJvdXRwdXRMYXllciIsInZhbHMiLCJ4IiwibGF5ZXJXaWR0aCIsInJhZGl1cyIsIm5vZGVzIiwibGF5ZXJIZWlnaHQiLCJkb21haW5NYXgiLCJzeSIsIk1hdGgiLCJmbG9vciIsImNsZWFyUmVjdCIsIm5vZGUiLCJueCIsIm55IiwieSIsInN0cm9rZVN0eWxlIiwiZmlsbFN0eWxlIiwiYmVnaW5QYXRoIiwiYXJjIiwiUEkiLCJzdHJva2UiLCJmaWxsIiwiZXJyIiwiQWJzdHJhY3RSZW5kZXJlciIsInhQYWRkaW5nIiwieVBhZGRpbmciLCJtYXhIZWlnaHQiLCJjeCIsImxheWVyQ29uZmlnIiwibm9kZVBhZGRpbmciLCJsYXllclBhZGRpbmciLCJncm91cFBhZGRpbmciLCJyZXNoYXBlIiwic2xpY2UiLCJyb3dzIiwiY29scyIsImdyb3VwcyIsInRvdGFsTm9kZXMiLCJuciIsIm5jIiwibmciLCJzdGVwIiwiZyIsIm1heCIsInBsb3RBY3RpdmF0aW9ucyJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBMkNBLEVBQU1DLEdBQzFCLGlCQUFaQyxTQUEwQyxpQkFBWEMsT0FDeENBLE9BQU9ELFFBQVVELElBQ1EsbUJBQVhHLFFBQXlCQSxPQUFPQyxJQUM5Q0QsT0FBTyxrQkFBbUIsR0FBSUgsR0FDSixpQkFBWkMsUUFDZEEsUUFBUSxtQkFBcUJELElBRTdCRCxFQUFLLG1CQUFxQkMsSUFSNUIsQ0FTbUIsb0JBQVRLLEtBQXVCQSxLQUFPQyxNQUFNLFdBQzlDLE8sWUNURSxJQUFJQyxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVUixRQUduQyxJQUFJQyxFQUFTSyxFQUFpQkUsR0FBWSxDQUN6Q0MsRUFBR0QsRUFDSEUsR0FBRyxFQUNIVixRQUFTLElBVVYsT0FOQVcsRUFBUUgsR0FBVUksS0FBS1gsRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU08sR0FHL0ROLEVBQU9TLEdBQUksRUFHSlQsRUFBT0QsUUEwRGYsT0FyREFPLEVBQW9CTSxFQUFJRixFQUd4QkosRUFBb0JPLEVBQUlSLEVBR3hCQyxFQUFvQlEsRUFBSSxTQUFTZixFQUFTZ0IsRUFBTUMsR0FDM0NWLEVBQW9CVyxFQUFFbEIsRUFBU2dCLElBQ2xDRyxPQUFPQyxlQUFlcEIsRUFBU2dCLEVBQU0sQ0FBRUssWUFBWSxFQUFNQyxJQUFLTCxLQUtoRVYsRUFBb0JnQixFQUFJ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QVN5QixFQUtyQnpCLEdBQVUwQyxFQUFlNUIsRUFDekJ1QixFQUFZbEIsS0FBS21DLElBQUlqQixFQUFXckMsR0FFaEMsRUFBS2QsT0FBTy9FLEdBQVEsQ0FDaEJBLE9BQ0F5RyxFQUFHMEIsRUFDSHpCLFdBQVlkLEVBQ1ppQixZQUFhaEIsRUFDYmMsU0FDQUMsUUFDQUUsWUFDQTNFLE1BQU96QyxHQUdYeUksR0FBTXZDLEtBSVZ1QyxHQUFNSCxHQUFZLEVBRWxCN0gsT0FBT3lCLE9BQU92QyxLQUFNLENBQUV1RyxNQUFPdUMsRUFBSXRDLE9BQVFxQyxLLDZHQ2xGbEMsQ0FDWHBHLFNBQVUsU0FFVjZFLE9BQVEsRUFDUjBCLFlBQWEsRUFDYkMsYUFBYyxHQUNkQyxhQUFjLEVBRWRQLFNBQVUsR0FDVkMsU0FBVSxHQUVWbUIsaUJBQWlCLEciLCJmaWxlIjoidGZqcy1tb2RlbC12aWV3Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFwidGZqcy1tb2RlbC12aWV3XCIsIFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcInRmanMtbW9kZWwtdmlld1wiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJ0ZmpzLW1vZGVsLXZpZXdcIl0gPSBmYWN0b3J5KCk7XG59KSh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDogdGhpcywgZnVuY3Rpb24oKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiaW1wb3J0IHBhcnNlTW9kZWwgZnJvbSAnLi9tb2RlbC1wYXJzZXInO1xuaW1wb3J0IENhbnZhc1JlbmRlcmVyIGZyb20gJy4vcmVuZGVyZXJzL2NhbnZhcy5yZW5kZXJlcic7XG5pbXBvcnQgZGVmYXVsdENvbmZpZyBmcm9tICcuL2RlZmF1bHQuY29uZmlnJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kZWxWaWV3IHtcblxuICAgIGNvbnN0cnVjdG9yKG1vZGVsLCBjdXN0b21Db25maWcpIHtcbiAgICAgICAgY29uc3QgY29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdENvbmZpZywgY3VzdG9tQ29uZmlnKTtcblxuICAgICAgICBsZXQgcmVuZGVyZXI7XG5cbiAgICAgICAgY29uZmlnLnByZWRpY3RDYWxsYmFjayA9IGlucHV0ID0+IHtcbiAgICAgICAgICAgIGlmIChyZW5kZXJlcikge1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnVwZGF0ZShtb2RlbCwgaW5wdXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uZmlnLmhvb2tDYWxsYmFjayA9IGxheWVyID0+IHtcbiAgICAgICAgICAgIGlmIChyZW5kZXJlcikge1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlcihsYXllcilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHBhcnNlTW9kZWwobW9kZWwsIGNvbmZpZykudGhlbihyZXMgPT4ge1xuICAgICAgICAgICAgcmVuZGVyZXIgPSBuZXcgQ2FudmFzUmVuZGVyZXIoY29uZmlnLCByZXMpO1xuICAgICAgICB9KVxuICAgIH1cbn0iLCJmdW5jdGlvbiBub29wKCkgeyB9XG5cbmFzeW5jIGZ1bmN0aW9uIHBhcnNlTW9kZWwobW9kZWwsIG9wdGlvbnMpIHtcblxuICBjb25zdCBwYXJzZWQgPSB7XG4gICAgbGF5ZXJNYXA6IHt9LFxuICAgIGxheWVyQXJyOiBbXVxuICB9O1xuXG4gIGNvbnN0IHBhcnNlckNvbmZpZyA9IHtcbiAgICBwcmVkaWN0Q2FsbGJhY2s6IG5vb3AsXG4gICAgaG9va0NhbGxiYWNrOiBub29wLFxuICAgIC4uLm9wdGlvbnNcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlTGF5ZXIobGF5ZXIsIG5leHRDb2x1bW4pIHtcblxuICAgIGNvbnN0IHtcbiAgICAgIG5hbWUsXG4gICAgICBpbnB1dCxcbiAgICAgIGlucHV0cyxcbiAgICAgIHNoYXBlLFxuICAgICAgc291cmNlTGF5ZXJcbiAgICB9ID0gbGF5ZXI7XG5cbiAgICBjb25zdCB7XG4gICAgICBnZXRXZWlnaHRzLFxuICAgICAgc2V0Q2FsbEhvb2ssXG4gICAgICBhY3RpdmF0aW9uXG4gICAgfSA9IHNvdXJjZUxheWVyIHx8IHt9O1xuXG4gICAgY29uc3QgY3VycmVudExheWVyID0ge1xuICAgICAgcHJldmlvdXNDb2x1bW46IFtdLFxuICAgICAgbmFtZSxcbiAgICAgIHNoYXBlLFxuICAgICAgd2VpZ2h0czoge30sXG4gICAgICBnZXRXZWlnaHRzOiBub29wLFxuICAgICAgbWFwUG9zaXRpb246IE9iamVjdC5rZXlzKHBhcnNlZC5sYXllck1hcCkubGVuZ3RoXG4gICAgfTtcblxuICAgIHBhcnNlZC5sYXllck1hcFtuYW1lXSA9IGN1cnJlbnRMYXllcjtcbiAgICBwYXJzZWQubGF5ZXJBcnIudW5zaGlmdChjdXJyZW50TGF5ZXIpO1xuXG4gICAgaWYgKGFjdGl2YXRpb24pIHtcbiAgICAgIGxldCBjbGFzc05hbWUgPSBhY3RpdmF0aW9uLmdldENsYXNzTmFtZSgpO1xuICAgICAgY3VycmVudExheWVyLmFjdGl2YXRpb24gPSB7XG4gICAgICAgIG5hbWU6IGNsYXNzTmFtZVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzZXRDYWxsSG9vaykge1xuICAgICAgc291cmNlTGF5ZXIuc2V0Q2FsbEhvb2soYXN5bmMgbGF5ZXJJbnB1dCA9PiB7XG4gICAgICAgIGN1cnJlbnRMYXllci5nZXRXZWlnaHRzKCk7XG4gICAgICAgIGN1cnJlbnRMYXllci5hY3RpdmF0aW9ucyA9IFtdXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGF5ZXJJbnB1dC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGN1cnJlbnRMYXllci5hY3RpdmF0aW9ucy5wdXNoKGF3YWl0IGxheWVySW5wdXRbaV0uZGF0YVN5bmMoKSlcbiAgICAgICAgfVxuICAgICAgICBwYXJzZXJDb25maWcuaG9va0NhbGxiYWNrKGN1cnJlbnRMYXllcik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoZ2V0V2VpZ2h0cykge1xuXG4gICAgICBjdXJyZW50TGF5ZXIuZ2V0V2VpZ2h0cyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3Qgd2VpZ2h0cyA9IGF3YWl0IHNvdXJjZUxheWVyLmdldFdlaWdodHMoKTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdlaWdodHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjb25zdCB3ZWlnaHQgPSB3ZWlnaHRzW2ldO1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIHJhbmtUeXBlLFxuICAgICAgICAgICAgbmFtZTogd2VpZ2h0TmFtZVxuICAgICAgICAgIH0gPSB3ZWlnaHQ7XG4gICAgICAgICAgY3VycmVudExheWVyLmhhc1dlaWdodHMgPSB0cnVlO1xuICAgICAgICAgIGN1cnJlbnRMYXllci53ZWlnaHRzW3JhbmtUeXBlXSA9IHtcbiAgICAgICAgICAgIG5hbWU6IHdlaWdodE5hbWUsXG4gICAgICAgICAgICB2YWx1ZXM6IGF3YWl0IHdlaWdodHNbaV0uZGF0YVN5bmMoKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjdXJyZW50TGF5ZXIuZ2V0V2VpZ2h0cygpO1xuICAgIH1cblxuICAgIGlmIChpbnB1dHMpIHtcbiAgICAgIGlucHV0cy5mb3JFYWNoKGlucCA9PiB7XG4gICAgICAgIHBhcnNlTGF5ZXIoaW5wLCBjdXJyZW50TGF5ZXIucHJldmlvdXNDb2x1bW4pO1xuICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgcGFyc2VMYXllcihpbnB1dCwgY3VycmVudExheWVyLnByZXZpb3VzQ29sdW1uKTtcbiAgICB9XG5cbiAgICBpZiAobmV4dENvbHVtbikge1xuICAgICAgbmV4dENvbHVtbi5wdXNoKGN1cnJlbnRMYXllcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIGN1cnJlbnRMYXllcjtcbiAgfVxuXG4gIGNvbnN0IHByZWRpY3QgPSBtb2RlbC5wcmVkaWN0O1xuXG4gIG1vZGVsLnByZWRpY3QgPSAoLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IHByZWRpY3QuYXBwbHkobW9kZWwsIGFyZ3MpO1xuICAgIG1vZGVsLm91dHB1dERhdGEgPSByZXN1bHQuZGF0YVN5bmMoKTtcbiAgICBwYXJzZXJDb25maWcucHJlZGljdENhbGxiYWNrKGFyZ3MpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgcGFyc2VkLm1vZGVsID0gYXdhaXQgcGFyc2VMYXllcihtb2RlbC5sYXllcnNbbW9kZWwubGF5ZXJzLmxlbmd0aCAtIDFdLm91dHB1dCk7XG5cbiAgaWYgKG9wdGlvbnMucHJpbnRTdGF0cykge1xuICAgIGNvbnN0IHtcbiAgICAgIGxheWVyQXJyXG4gICAgfSA9IHBhcnNlZDtcbiAgICBjb25zb2xlLmxvZyhuZXcgQXJyYXkoMTApLmpvaW4oJy0nKSk7XG4gICAgbGF5ZXJBcnIuZm9yRWFjaChsYXllciA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhgTGF5ZXI6ICR7bGF5ZXIubmFtZX1gKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBwYXJzZWQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHBhcnNlTW9kZWw7XG4iLCJpbXBvcnQgQWJzdHJhY3RSZW5kZXJlciBmcm9tICcuL2Fic3RyYWN0LnJlbmRlcmVyJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FudmFzUmVuZGVyZXIgZXh0ZW5kcyBBYnN0cmFjdFJlbmRlcmVyIHtcbiAgICBjb25zdHJ1Y3Rvcihjb25maWcsIGluaXREYXRhKSB7XG4gICAgICAgIHN1cGVyKGNvbmZpZywgaW5pdERhdGEpO1xuICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcblxuICAgICAgICBjYW52YXMuc2V0QXR0cmlidXRlKCd3aWR0aCcsIHRoaXMud2lkdGgpO1xuICAgICAgICBjYW52YXMuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCB0aGlzLmhlaWdodCk7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTtcblxuICAgICAgICB0aGlzLnJlbmRlckNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuICAgICAgICB0aGlzLnJlbmRlckVsZW1lbnQgPSBjYW52YXM7XG4gICAgfVxuXG4gICAgdXBkYXRlKG1vZGVsLCBpbnB1dCkge1xuICAgICAgICBjb25zdCBpbnB1dHMgPSBPYmplY3Qua2V5cyh0aGlzLmxheWVycykuZmlsdGVyKG5hbWUgPT4gbmFtZS5pbmRleE9mKCdfaW5wdXQnKSAhPT0gLTEpO1xuXG4gICAgICAgIGlmIChpbnB1dHMubGVuZ3RoICE9PSBpbnB1dC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgaWRlbnRpZmllZCAyIGlucHV0IGxheWVyczogJHtpbnB1dHMuam9pbignLCcpfSBhbmQgaGFkIG9ubHkgJHtpbnB1dC5sZW5ndGh9IGlucHV0IHZhbHVlc2ApO1xuICAgICAgICB9XG5cbiAgICAgICAgaW5wdXRzLmZvckVhY2goKG5hbWUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcih7IG5hbWUgfSwgaW5wdXRbaW5kZXhdLmRhdGFTeW5jKCkpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnJlbmRlcih0aGlzLm91dHB1dExheWVyLCBtb2RlbC5vdXRwdXREYXRhKTtcbiAgICB9XG5cbiAgICByZW5kZXIobGF5ZXIsIGFjdGl2YXRpb25zLCBvdXRwdXREYXRhKSB7XG4gICAgICAgIGNvbnN0IHsgbmFtZSwgcHJldmlvdXNDb2x1bW4gfSA9IGxheWVyO1xuICAgICAgICBpZiAoYWN0aXZhdGlvbnMgfHwgb3V0cHV0RGF0YSkge1xuICAgICAgICAgICAgY29uc3QgdmFscyA9IGFjdGl2YXRpb25zIHx8IG91dHB1dERhdGFcbiAgICAgICAgICAgIGNvbnN0IHsgaGVpZ2h0IH0gPSB0aGlzO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgeCwgbGF5ZXJXaWR0aCwgcmFkaXVzLCBub2RlcywgbGF5ZXJIZWlnaHQsIGRvbWFpbk1heCB9ID0gdGhpcy5sYXllcnNbbmFtZV07XG4gICAgICAgICAgICAgICAgY29uc3Qgc3kgPSBNYXRoLmZsb29yKChoZWlnaHQgLSBsYXllckhlaWdodCkgLyAyKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckNvbnRleHQuY2xlYXJSZWN0KHggLSByYWRpdXMgLyAyIC0gMiwgMCwgbGF5ZXJXaWR0aCArIDIsIGhlaWdodCk7XG5cbiAgICAgICAgICAgICAgICBub2Rlcy5mb3JFYWNoKChub2RlLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHg6IG54LCB5OiBueSB9ID0gbm9kZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJDb250ZXh0LnN0cm9rZVN0eWxlID0gJyMwMDAnO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckNvbnRleHQuZmlsbFN0eWxlID0gYHJnYmEoMCwwLDAsICR7dmFsc1tpbmRleF0gLyBkb21haW5NYXh9KWBcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJDb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckNvbnRleHQuYXJjKG54LCBzeSArIG55LCByYWRpdXMgLyAyLCAwLCAyICogTWF0aC5QSSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJhZGl1cyA+IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyQ29udGV4dC5zdHJva2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckNvbnRleHQuZmlsbCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgZGVidWdnZXJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChwcmV2aW91c0NvbHVtbiAmJiBwcmV2aW91c0NvbHVtbi5sZW5ndGggPiAwICYmIGxheWVyLmFjdGl2YXRpb25zKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxheWVyLnByZXZpb3VzQ29sdW1uLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIobGF5ZXIucHJldmlvdXNDb2x1bW5baV0sIGxheWVyLmFjdGl2YXRpb25zW2ldKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFic3RyYWN0UmVuZGVyZXIge1xuXG4gICAgY29uc3RydWN0b3IoY29uZmlnLCBpbml0RGF0YSkge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICB4UGFkZGluZyxcbiAgICAgICAgICAgIHlQYWRkaW5nLFxuICAgICAgICAgICAgbGF5ZXIgPSB7fSxcbiAgICAgICAgfSA9IGNvbmZpZztcbiAgICAgICAgY29uc3QgeyBsYXllckFyciB9ID0gaW5pdERhdGE7XG5cbiAgICAgICAgbGV0IG1heEhlaWdodCA9ICh5UGFkZGluZyB8fCAxKSAqIDI7XG4gICAgICAgIGxldCBjeCA9IHhQYWRkaW5nIHx8IDBcblxuICAgICAgICB0aGlzLmxheWVycyA9IHt9O1xuXG5cbiAgICAgICAgbGF5ZXJBcnIuZm9yRWFjaChsID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgbmFtZSwgc2hhcGUsIGFjdGl2YXRpb24gfSA9IGw7XG4gICAgICAgICAgICB0aGlzLm91dHB1dExheWVyID0gbDtcbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbUNvbmZpZyA9IGxheWVyW25hbWVdIHx8IHt9O1xuICAgICAgICAgICAgY29uc3QgbGF5ZXJDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBjb25maWcsIGN1c3RvbUNvbmZpZylcbiAgICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgICAgICByYWRpdXMsXG4gICAgICAgICAgICAgICAgbm9kZVBhZGRpbmcsXG4gICAgICAgICAgICAgICAgbGF5ZXJQYWRkaW5nLFxuICAgICAgICAgICAgICAgIGdyb3VwUGFkZGluZyxcbiAgICAgICAgICAgICAgICBkb21haW5NYXggPSAxLFxuICAgICAgICAgICAgICAgIHJlc2hhcGUgfSA9IGxheWVyQ29uZmlnO1xuICAgICAgICAgICAgbGV0IFtyb3dzLCBjb2xzLCBncm91cHNdID0gT2JqZWN0LmFzc2lnbihbMSwgMSwgMV0sIHNoYXBlLnNsaWNlKDEpKTtcblxuICAgICAgICAgICAgY29uc3QgdG90YWxOb2RlcyA9IHJvd3MgKiBjb2xzICogZ3JvdXBzO1xuXG4gICAgICAgICAgICBpZiAocmVzaGFwZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IFtuciwgbmMsIG5nXSA9IE9iamVjdC5hc3NpZ24oWzEsIDEsIDFdLCByZXNoYXBlKTtcbiAgICAgICAgICAgICAgICBpZiAobnIgKiBuYyAqIG5nICE9PSB0b3RhbE5vZGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIHJlc2hhcGUgZnJvbSBbJHtyb3dzfSwgJHtjb2xzfSwgJHtncm91cHN9XSB0byBbJHtucn0sICR7bmN9LCAke25nfV1gKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJvd3MgPSBucjtcbiAgICAgICAgICAgICAgICBjb2xzID0gbmM7XG4gICAgICAgICAgICAgICAgZ3JvdXBzID0gbmc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN4ICs9IGxheWVyUGFkZGluZztcbiAgICAgICAgICAgIGNvbnN0IHN0ZXAgPSByYWRpdXMgKyBub2RlUGFkZGluZztcbiAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gbGF5ZXJQYWRkaW5nICsgY29scyAqIHN0ZXBcbiAgICAgICAgICAgIGNvbnN0IG5vZGVzID0gW107XG4gICAgICAgICAgICBsZXQgaGVpZ2h0ID0gMDtcblxuICAgICAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCByb3dzOyByKyspIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IGNvbHM7IGMrKykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBnID0gMDsgZyA8IGdyb3VwczsgZysrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB5ID0gZ3JvdXBQYWRkaW5nICsgcmFkaXVzICsgciAqIHN0ZXAgKyBnICogcm93cyAqIChzdGVwICsgZ3JvdXBQYWRkaW5nKVxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogY3ggKyBjICogc3RlcCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IHk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGhlaWdodCArPSBncm91cFBhZGRpbmcgKyByYWRpdXM7XG4gICAgICAgICAgICBtYXhIZWlnaHQgPSBNYXRoLm1heChtYXhIZWlnaHQsIGhlaWdodCk7XG5cbiAgICAgICAgICAgIHRoaXMubGF5ZXJzW25hbWVdID0ge1xuICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgeDogY3gsXG4gICAgICAgICAgICAgICAgbGF5ZXJXaWR0aDogd2lkdGgsXG4gICAgICAgICAgICAgICAgbGF5ZXJIZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgICAgICByYWRpdXMsXG4gICAgICAgICAgICAgICAgbm9kZXMsXG4gICAgICAgICAgICAgICAgZG9tYWluTWF4LFxuICAgICAgICAgICAgICAgIGxheWVyOiBsXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN4ICs9IHdpZHRoO1xuXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGN4ICs9IHhQYWRkaW5nIHx8IDA7XG5cbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7IHdpZHRoOiBjeCwgaGVpZ2h0OiBtYXhIZWlnaHQgfSk7XG4gICAgfVxuXG59IiwiZXhwb3J0IGRlZmF1bHQge1xuICAgIHJlbmRlcmVyOiAnY2FudmFzJyxcblxuICAgIHJhZGl1czogNixcbiAgICBub2RlUGFkZGluZzogMixcbiAgICBsYXllclBhZGRpbmc6IDIwLFxuICAgIGdyb3VwUGFkZGluZzogMSxcbiAgICBcbiAgICB4UGFkZGluZzogMTAsXG4gICAgeVBhZGRpbmc6IDEwLFxuICAgXG4gICAgcGxvdEFjdGl2YXRpb25zOiBmYWxzZVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==